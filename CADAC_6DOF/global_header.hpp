///////////////////////////////////////////////////////////////////////////////
//FILE: 'global_header.hpp'
//
//Global structures and classes: 'Module', 'Variable', 'File', 'Event', '
// '
// with inline member function definitions
//
//001206 Created by Peter Zipfel
//030404 Adapted to HYPER6 simulation, PZi
///////////////////////////////////////////////////////////////////////////////

#define _CRT_SECURE_NO_DEPRECATE
#ifndef global_header__HPP
#define global_header__HPP

#include <fstream>
#include <string>		
#include "utility_header.hpp"

using namespace std;

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
//Structure 'Module'
//
//Provides the structure for the modules of the simulation
//
//010107 Created by Peter Zipfel
///////////////////////////////////////////////////////////////////////////////
struct Module
{
	string name;
	string definition;
	string initialization;
	string execution;
	string termination;
};

///////////////////////////////////////////////////////////////////////////////
//Class 'Variable'
//Establishing module-variables as type Variable
//Provides the class for the variables used in modules
//
//001125 Created by Peter Zipfel
///////////////////////////////////////////////////////////////////////////////

class Variable 
{
private:
	char name[CHARN]={}; //label of variable
	char type[CHARN]={}; //type of variable 'int'; default is real
	double rval=0;	  //real value, double
	int ival=0;         //integer value, int
	Matrix VEC;		  //vector 
	Matrix MAT;		  //matrix 
	char def[CHARL]={};  //definition and units
	char mod[CHARN]={};  //module where variable is calculated
	char role[CHARN]={}; //role that variable pays: 'data', 'state', 'diag', 'out'
	char out[CHARN]={};  //output for: 'scrn', 'plot', 'com'
	char error[2];	  //error code '*' = SAME LOCATION multiple, overwritten definitions
					  //           'A' = SAME NAME assigned to multiple locations 
public:
	Variable()
	{
		VEC.dimension(3,1);MAT.dimension(3,3);
		strcpy(name,"empty");
		error[0]=' ';error[1]='\0';
		int dum=1;
	}; 
	~Variable(){};
//////////////////////////// Protopypes ///////////////////////////////////////
void init(const char * na,double rv,const char * de,const char * mo,const char * ro,const char * ou);
void init(const char * na,const char * ty,int iv,const char * de,const char * mo,const char * ro,const char * ou);
void init(const char * na,double v1,double v2,double v3,const char * de,const char * mo,const char * ro,const char * ou);
void init(const char * na,double v11,double v12,double v13,double v21,double v22,double v23,
					double v31,double v32,double v33,const char * de,const char * mo,const char * ro,const char * ou);

////////////////////////// Inline Functions ///////////////////////////////////

	///////////////////////////////////////////////////////////////////////////
	//Obtaining 'name' from module-variable array 
	//
	//001213 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	const char * get_name(){return name;}
	
	///////////////////////////////////////////////////////////////////////////
	//Obtaining 'type' from module-variable array 
	//
	//001213 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	const char * get_type(){return type;}
	
	///////////////////////////////////////////////////////////////////////////
	//Obtaining value (of type 'double') from module-variable array to local variable
	//Example: double thrust_com=hyper[13].real();
	//
	//001128 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	double real(){return rval;}
	
	///////////////////////////////////////////////////////////////////////////
	//Obtaining value (of type 'int') from module-variable array to local variable
	//Example: int mprop=hyper[10].integer();
	//
	//001128 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	int integer(){return ival;}
	
	///////////////////////////////////////////////////////////////////////////
	//Obtaining vector value (of type 'Matrix') from module-variable array to local variable
	//Example: Matrix FSPV=round6[200].vec();
	//
	//001128 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	Matrix vec(){return VEC;}
	
	///////////////////////////////////////////////////////////////////////////
	//Obtaining matrix value (of type 'Matrix') from module-variable array to local variable
	//Example: Matrix TGV=round6[22].mat();
	//
	//001226 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	Matrix mat(){return MAT;}
	
	///////////////////////////////////////////////////////////////////////////
	//Four-times overloaded function gets()
	//Loads module-variable onto module-variable array
	//Overloaded for real, integer and vector variables
	//Example: hyper[10].gets(mprop);
	//
	//001128 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	double gets(double rv)
	{
		rval=rv;
		return rval;
	}
	
	double gets(int iv)
	{
		ival=iv;
		return ival;
	} 
	Matrix gets_vec(Matrix VE)
	{
		VEC=VE;
		return VEC;
	} 

	Matrix gets_mat(Matrix MA)
	{
		MAT=MA;
		return MAT;
	} 

	///////////////////////////////////////////////////////////////////////////
	//Obtaining 'def' from module-variable array 
	//
	//001213 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	const char * get_def(){return def;}
	
	///////////////////////////////////////////////////////////////////////////
	//Obtaining 'mod' from module-variable array 
	//
	//001213 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	const char * get_mod(){return mod;}
	
	///////////////////////////////////////////////////////////////////////////
	//Obtaining 'role' from module-variable array 
	//
	//001213 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	const char * get_role(){return role;}
	
	///////////////////////////////////////////////////////////////////////////
	//Obtaining 'out' from module-variable array 
	//
	//001213 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	const char * get_out(){return out;}

	///////////////////////////////////////////////////////////////////////////
	//Obtaining 'error' code from module-variable array 
	//
	//020909 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	const char * get_error(){return error;}
	
	///////////////////////////////////////////////////////////////////////////
	//Putting 'error' code into module-variable  
	//Error code must be single caracter
	//020911 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////
	void put_error(const char * error_code){strcpy(error,error_code);}
};


///////////////////////////////////////////////////////////////////////////////
//Class 'Table'
//Stores table data
//
//030710 Created by Peter Zipfel
///////////////////////////////////////////////////////////////////////////////
class Table 
{
private:
	string name="";	//table name 										
	int dim=0;	//table dimension (1,2, or 3)										
	int	var1_dim=0;	// variable 1 dimension	
	int	var2_dim=0;	// variable 2 dimension	
	int	var3_dim=0;	// variable 3 dimension	
public:
	double *var1_values=nullptr;  //values of variable 1 
	double *var2_values=nullptr;  //values of variable 2 
	double *var3_values=nullptr;  //values of variable 3
	double *data=nullptr; // table data values packaged in one array

	Table(){}
	virtual ~Table()
	{
		delete var1_values;
		delete var2_values;
		delete var3_values;
		delete data;
	}

	///////////////////////////////////////////////////////////////////////////
	//Getting dimension of table
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	int get_dim(){return dim;}

	///////////////////////////////////////////////////////////////////////////
	//Getting name of table
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	string get_name(){return name;}

	///////////////////////////////////////////////////////////////////////////
	//Getting 1. independent variable dimension
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	int get_var1_dim(){return var1_dim;}

	///////////////////////////////////////////////////////////////////////////
	//Getting 2. independent variable dimension
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	int get_var2_dim(){return var2_dim;}

	///////////////////////////////////////////////////////////////////////////
	//Getting 3. independent variable dimension
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	int get_var3_dim(){return var3_dim;}
	
	///////////////////////////////////////////////////////////////////////////
	//Setting dimension of table
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	void set_dim(int table_dim){dim=table_dim;}

	///////////////////////////////////////////////////////////////////////////
	//Setting name of table
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	void set_name(string tbl_name){name=tbl_name;}

	///////////////////////////////////////////////////////////////////////////
	//Setting 1. independent variable dimension
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	void set_var1_dim(int size){var1_dim=size;}

	///////////////////////////////////////////////////////////////////////////
	//Setting 2. independent variable dimension
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	void set_var2_dim(int size){var2_dim=size;}

	///////////////////////////////////////////////////////////////////////////
	//Setting 3. independent variable dimension
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	void set_var3_dim(int size){var3_dim=size;}

	///////////////////////////////////////////////////////////////////////////
	//Setting 1. independent variable values
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	void set_var1_value(int offset,double value){
		var1_values[offset]=value;	
	}
	///////////////////////////////////////////////////////////////////////////
	//Setting 2. independent variable values
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	void set_var2_value(int offset,double value){
		var2_values[offset]=value;	
	}
	///////////////////////////////////////////////////////////////////////////
	//Setting 3. independent variable values
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	void set_var3_value(int offset,double value){
		var3_values[offset]=value;	
	}
	///////////////////////////////////////////////////////////////////////////
	//Setting tablular data values 
	//030710 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////
	void set_data(int offset,double value){
		data[offset]=value;	
	}
};

///////////////////////////////////////////////////////////////////////////////
//Class 'Datadeck'
//provides the 'Datadeck' class declaration for table look-ups
//
//030710 Created by Peter Zipfel
///////////////////////////////////////////////////////////////////////////////
class Datadeck
{
private:
	string title=""; //title of data deck
	int capacity=0; //total number of tables
	int tbl_counter=0; //table counter
	Table **table_ptr=nullptr; //table_ptr is pointer to a pointer array of type 'Table'

public:

	Datadeck(){}
	virtual ~Datadeck(){ delete [] table_ptr;}

	///////////////////////////////////////////////////////////////////////////////
	//Allocating memory  table deck title 
	//030711 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	void alloc_mem(){table_ptr=new Table *[capacity];}		

	///////////////////////////////////////////////////////////////////////////////
	//Setting table deck title 
	//030711 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	void set_title(string deck_title){title=deck_title;}

	///////////////////////////////////////////////////////////////////////////////
	//Getting table deck title 
	//030711 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	string get_title(){return title;}

	///////////////////////////////////////////////////////////////////////////////
	//Setting total number of tables 
	//030711 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	void set_capacity(int table_numbers){capacity=table_numbers;}

	///////////////////////////////////////////////////////////////////////////////
	//Getting total number of tables 
	//030711 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	int get_capacity(){return capacity;}

	///////////////////////////////////////////////////////////////////////////////
	//Setting table counter 
	//030711 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	void set_counter(int count){tbl_counter=count;}

	///////////////////////////////////////////////////////////////////////////////
	//Getting table counter 
	//030711 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	int get_counter(){return tbl_counter;}

	///////////////////////////////////////////////////////////////////////////////
	//Adding a table pointer to the table list 
	//030711 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	void add_table(Table &pt)
	{
		if(tbl_counter<capacity){
			table_ptr[tbl_counter]=&pt;
		}
	}
	///////////////////////////////////////////////////////////////////////////////
	//Overloaded operator [] returns a 'Table' pointer
	//030711 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	Table * operator[](int slot)
	{
		if(slot>=0 && slot<capacity)
			return table_ptr[slot];
		else
		{
			cout<<"*** Bad pointer value of table deck: "<<slot<<'\n';
			return 0;
		}
	}

	///////////////////////////////////////////////////////////////////////////////
	//Getting table pointer 
	//030717 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	Table * get_tbl(int slot){return table_ptr[slot];}

	///////////////////////////////////////////////////////////////////////////////
	//Single independent variable look-up
	//constant extrapolation at the upper end, slope extrapolation at the lower end
	//
	//030717 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	double look_up(string name,double value1);

	///////////////////////////////////////////////////////////////////////////////
	//Two independent variables look-up
	// Constant extrapolation at the upper end, slope extrapolation at the lower end
	//
	//030717 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	double look_up(string name,double value1,double value2);

	///////////////////////////////////////////////////////////////////////////////
	//Three independent variables look-up
	//constant extrapolation at the upper end, slope extrapolation at the lower end
	//
	//030723 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	double look_up(string name,double value1,double value2,double value3);

	///////////////////////////////////////////////////////////////////////////////
	//Table index finder
	//This is a binary search method it is O(lgN)
	//* Returns array locater of the discrete_variable just below variable
	//* Keeps max or min array locater if variable is outside those max or min  
	//
	//010628 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	int find_index(int max,double value,double *list);

	///////////////////////////////////////////////////////////////////////////////
	//Linear one-dimensional interpolation
	// Constant extrapolation beyond max values of X1
	// Slope extrapolation beyond min values of X1
	//
	//030717 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	double interpolate(int ind,int ind2,int slot,double val);

	///////////////////////////////////////////////////////////////////////////////
	//Linear, two-dimensional interpolation
	// Constant extrapolation beyond max values of X1 and X2
	// Slope extrapolation beyond min values of X1 and X2
	//
	//030718 Created by Peter H Zipfel
	///////////////////////////////////////////////////////////////////////////////
	double interpolate(int ind10,int ind11,int ind20,int ind21,int slot,double value1,
						double value2);																

	///////////////////////////////////////////////////////////////////////////////
	//Linear, three-dimensional interpolation
	//Constant extrapolation beyond max values of X1, X2 and X3
	//Slope extrapolation beyond min values of X1, X2 and X3
	//
	//030723 Created by Peter Zipfel
	///////////////////////////////////////////////////////////////////////////////
	double interpolate(int ind10,int ind11,int ind20,int ind21,int ind30,int ind31,
								 int slot,double value1,double value2,double value3);
																					
};
#endif
